# name: deploy-in-docker-mo-759

# on:
#   push:
#     branches:
#       - deploy-in-docker-mo-759

# jobs:
#   build:
#     runs-on: ubuntu-latest
#     name: Build, Push and Deploy
#     permissions:
#       contents: read
#       packages: write
    
#     env:
#       REGISTRY: ghcr.io
#       REPOSITORY: ${{ github.repository }}
#       IMAGE_TAG: ${GITHUB_SHA:0:8}
      
#     steps:
#       - name: Checkout
#         uses: actions/checkout@v3

#       - name: Login to GitHub Container Registry
#         uses: docker/login-action@v2
#         with:
#           registry:  ${{ env.REGISTRY }}
#           username: ${{ github.actor }}
#           password: ${{ secrets.GITHUB_TOKEN }}

#       - name: Build and push Docker image
#         uses: docker/build-push-action@v4
#         with:
#           context: .
#           push: true
#           tags: ${{ env.REGISTRY }}/${{ env.REPOSITORY }}:${{ env.IMAGE_TAG }}

#       - name: set env
#         run: |
#           touch .env
#           echo "REGISTRY={{ env.REGISTRY }}" > .env
#           echo "REPOSITORY=${{ env.REPOSITORY }}" >> .env
#           echo "TAG=${{ env.IMAGE_TAG }}" >> .env

#       - name: copy docker-compose and env to EC2
#         uses: appleboy/scp-action@v0.1.4
#         with:
#           host:     ${{ vars.EC2_HOSTNAME }}
#           username: ${{ vars.EC2_USERNAME }}
#           key:      ${{ secrets.EC2_SSH_KEY }}
#           port: 22
#           source: "docker-compose-remote.yml,.env"
#           target: "~/"
